{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Project Quote Configuration",
  "description": "A schema for configuring a new project or quote, based on panel, sub-assembly, and custom features.",
  "type": "object",
  "properties": {
    "quoteId": {
      "description": "The unique quote number (e.g., 'CQ251031035-10100110-0').",
      "type": "string"
    },
    "projectId": {
      "description": "Optional: The project number if the quote is approved (e.g., 'CA251031035-10100110').",
      "type": "string"
    },
    "projectName": {
      "description": "Human-readable name for the project.",
      "type": "string"
    },
    "customer": {
      "description": "Customer ID or name.",
      "type": "string"
    },
    "salesRep": {
      "type": "string"
    },
    "oem": {
      "type": "string"
    },
    "status": {
      "description": "The current state of the quote/project.",
      "type": "string",
      "enum": ["draft", "quoted", "approved", "in_progress", "complete"],
      "default": "draft"
    },
    "projectCodes": {
      "description": "The 4-pillar classification codes for this project.",
      "type": "object",
      "properties": {
        "industry": {
          "oneOf": [
            { "const": 10, "description": "Chemical & Pharmaceutical Industries" },
            { "const": 11, "description": "General Chemical" },
            { "const": 12, "description": "Pharmaceutical" },
            { "const": 13, "description": "Biotech" },
            { "const": 19, "description": "Other Chem & Pharm" },
            { "const": 20, "description": "Food & Beverage Industries" },
            { "const": 21, "description": "Brewery & Distilling" },
            { "const": 22, "description": "Food Processing" },
            { "const": 29, "description": "Other Food & Beverage" },
            { "const": 30, "description": "Utilities & Infrastructure" },
            { "const": 31, "description": "Water & Wastewater" },
            { "const": 32, "description": "Power Generation" },
            { "const": 33, "description": "Grain Processing" },
            { "const": 39, "description": "Other Utilities" },
            { "const": 40, "description": "Manufacturing Industries" },
            { "const": 41, "description": "General Manufacturing" },
            { "const": 42, "description": "Automotive" },
            { "const": 49, "description": "Other Manufacturing" },
            { "const": 50, "description": "Pharma & Biotech (Expanded)" },
            { "const": 51, "description": "Pharma" },
            { "const": 52, "description": "Biotech" },
            { "const": 59, "description": "Other Pharma/Biotech" },
            { "const": 90, "description": "Commercial" },
            { "const": 99, "description": "Other (Not Categorized)" }
          ]
        },
        "product": {
          "oneOf": [
            { "const": 100, "description": "Brewhouse" },
            { "const": 101, "description": "Vessel" },
            { "const": 149, "description": "Brewery General" },
            { "const": 150, "description": "Distilling" },
            { "const": 151, "description": "Batch" },
            { "const": 152, "description": "Chamber" },
            { "const": 153, "description": "Continuous" },
            { "const": 199, "description": "Distillery General" },
            { "const": 200, "description": "Cellar" },
            { "const": 201, "description": "Single Tank Simple" },
            { "const": 202, "description": "Single Tank Advanced" },
            { "const": 203, "description": "Glycol Monitoring" },
            { "const": 249, "description": "Fermentation General" },
            { "const": 250, "description": "Grain Handling" },
            { "const": 251, "description": "Flow Scale" },
            { "const": 252, "description": "Loadcell" },
            { "const": 253, "description": "Spent Grain" },
            { "const": 299, "description": "Grain General" },
            { "const": 300, "description": "Motor" },
            { "const": 301, "description": "Non-Fused Switch" },
            { "const": 302, "description": "Non-Fused VFD" },
            { "const": 303, "description": "Fused Switch" },
            { "const": 304, "description": "Fused VFD" },
            { "const": 349, "description": "Motor Control General" },
            { "const": 400, "description": "Pneumatic" },
            { "const": 401, "description": "Switch" },
            { "const": 402, "description": "Keyed Switch" },
            { "const": 449, "description": "Pneumatics General" },
            { "const": 450, "description": "CIP" },
            { "const": 451, "description": "Keg Washer" },
            { "const": 499, "description": "Sanitary General" },
            { "const": 500, "description": "Remote" },
            { "const": 549, "description": "Remote General" },
            { "const": 550, "description": "Heater Control" },
            { "const": 599, "description": "Heating General" },
            { "const": 990, "description": "General" }
          ]
        },
        "control": {
          "oneOf": [
            { "const": 1, "description": "Pneumatic Control" },
            { "const": 2, "description": "Electronic Control" },
            { "const": 3, "description": "Digital Control" },
            { "const": 4, "description": "Hybrid Control" }
          ]
        },
        "scope": {
          "oneOf": [
            { "const": 10, "description": "Design Only" },
            { "const": 20, "description": "Supply Only" },
            { "const": 30, "description": "Install Only" },
            { "const": 40, "description": "Design & Supply" },
            { "const": 50, "description": "Design & Install" },
            { "const": 60, "description": "Supply & Install" },
            { "const": 70, "description": "Design, Supply & Install" },
            { "const": 80, "description": "Commissioning Only" },
            { "const": 81, "description": "FAT Only" },
            { "const": 82, "description": "SAT Only" },
            { "const": 83, "description": "FAT & SAT" },
            { "const": 84, "description": "IQ Only" },
            { "const": 85, "description": "OQ Only" },
            { "const": 86, "description": "PQ Only" },
            { "const": 87, "description": "IQ/OQ" },
            { "const": 88, "description": "OQ/PQ" },
            { "const": 89, "description": "IQ/OQ/PQ (Full Validation)" },
            { "const": 90, "description": "Service & Maintenance" },
            { "const": 95, "description": "Consulting Only" },
            { "const": 99, "description": "Other (Custom Scope)" }
          ]
        }
      },
      "required": ["industry", "product", "control", "scope"]
    },
    "controlPanelConfig": {
      "description": "Base configuration for the main control panel.",
      "type": "object",
      "properties": {
        "voltage": { "type": "string" },
        "phase": { "type": "string" },
        "enclosureType": { "type": "string" },
        "enclosureRating": { "type": "string" },
        "hmiSize": { "type": "string" },
        "plcPlatform": { "type": "string" },
        "disconnect": { "type": "string" },
        "plcModel": { "type": "string" },
        "ioCapacity": {
          "type": "object",
          "properties": {
            "AI": { "type": "integer", "default": 0 },
            "DI": { "type": "integer", "default": 0 },
            "AO": { "type": "integer", "default": 0 },
            "DO": { "type": "integer", "default": 0 }
          }
        },
        "safetyRating": { "type": "string" },
        "networkProtocols": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["voltage", "phase", "enclosureType", "hmiSize", "plcPlatform"]
    },
    "productConfiguration": {
      "description": "Product-specific inputs used to auto-generate the sub-assembly list (Your Step 3).",
      "type": "object",
      "properties": {
        "motors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "hp": { "type": "number" },
              "controlType": { "type": "string", "enum": ["VFD", "On/Off"] }
            },
            "required": ["name", "hp", "controlType"]
          }
        },
        "heaters": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "kw": { "type": "number" },
              "controlType": { "type": "string", "enum": ["SSR", "On/Off"] }
            },
            "required": ["name", "kw", "controlType"]
          }
        },
        "inputs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "type": { "type": "string", "enum": ["Temp", "Level", "Pressure", "Flow", "Loadcell", "Prox", "Custom"] }
            },
            "required": ["name", "type"]
          }
        },
        "outputs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "type": { "type": "string", "enum": ["Modulating", "On/Off", "Pneumatic", "Custom"] }
            },
            "required": ["name", "type"]
          }
        }
      },
      "default": {}
    },
    "selectedSubAssemblies": {
      "description": "List of sub-assemblies from the library to include in this panel.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "subAssemblyId": {
            "description": "Links to the subAssemblyId in sub_assembly_schema.json.",
            "type": "string"
          },
          "quantity": { "type": "integer", "default": 1 },
          "customName": { "type": "string" },
          "configuration": {
            "description": "Key-value pairs for sub-assembly-specific options.",
            "type": "object",
            "additionalProperties": true
          },
          "selectedFeatures": {
            "type": "array",
            "items": { "type": "string" }
          },
          "selectedSubAssemblies": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "required": ["subAssemblyId", "quantity"]
      },
      "default": []
    },
    "customFeatures": {
      "description": "One-off items or labor charges specific to this quote.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "cost": { "type": "number", "default": 0 },
          "laborHours": { "type": "number", "default": 0 }
        },
        "required": ["id", "name", "cost"]
      },
      "default": []
    },
    "bom": {
      "description": "Legacy BOM structure - array of sub-assembly IDs with quantities. Deprecated in favor of operationalItems.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "assemblyId": { 
            "type": "string",
            "description": "Legacy field - use subAssemblyId in new code. Maintained for backward compatibility."
          },
          "subAssemblyId": {
            "type": "string",
            "description": "Sub-assembly ID linking to sub_assembly_schema.json"
          },
          "quantity": { "type": "integer", "minimum": 1 },
          "notes": { "type": "string" }
        },
        "required": ["quantity"]
      },
      "default": []
    },
    "operationalItems": {
      "description": "Consolidated list of operational items (components) with quantities, pricing, and presentation attributes.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "sku": { "type": "string" },
          "description": { "type": "string" },
          "quantity": { "type": "integer", "minimum": 1 },
          "unitPrice": { "type": "number", "minimum": 0 },
          "totalPrice": { "type": "number", "minimum": 0 },
          "vendor": { "type": "string" },
          "vndrnum": { "type": "string" },
          "category": { "type": "string" },
          "sectionGroup": {
            "type": "string",
            "enum": ["Hardware", "Components", "Labor", "Other"],
            "description": "Grouping for quote document presentation"
          },
          "displayName": {
            "type": "string",
            "description": "Human-readable name for quote document (e.g., 'Main PLC', 'VFD Starter - Motor 1')"
          },
          "sourceSubAssembly": {
            "type": "string",
            "description": "Sub-assembly ID that contributed this component (if applicable)"
          },
          "sourceRule": {
            "type": "string",
            "description": "Rule ID that generated this component (if applicable, e.g., 'ioFieldRule.motor_vfd')"
          },
          "notes": { "type": "string" }
        },
        "required": ["sku", "quantity", "unitPrice", "totalPrice"]
      },
      "default": []
    },
    "validationErrors": {
      "description": "Configuration validation errors and warnings.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "severity": { "type": "string", "enum": ["error", "warning", "info"] },
          "code": { "type": "string" },
          "message": { "type": "string" },
          "field": { "type": "string" },
          "suggestion": { "type": "string" }
        },
        "required": ["severity", "code", "message"]
      },
      "default": []
    },
    "pricing": {
      "description": "Calculated pricing breakdown for this quote.",
      "type": "object",
      "properties": {
        "materialCost": { "type": "number", "minimum": 0 },
        "laborCost": { "type": "number", "minimum": 0 },
        "totalCOGS": { "type": "number", "minimum": 0 },
        "finalPrice": { "type": "number", "minimum": 0 },
        "marginPercent": { "type": "number", "minimum": 0, "maximum": 100 }
      },
      "default": {
        "materialCost": 0,
        "laborCost": 0,
        "totalCOGS": 0,
        "finalPrice": 0,
        "marginPercent": 0
      }
    },
    "pipedrive_deal_id": {
      "description": "Pipedrive deal ID if this quote is linked to a Pipedrive deal (Phase 2 integration).",
      "type": ["string", "null"],
      "default": null
    },
    "pipedrive_person_id": {
      "description": "Pipedrive person ID if this quote is linked to a Pipedrive person (Phase 2 integration).",
      "type": ["string", "null"],
      "default": null
    },
    "historical_margin_avg": {
      "description": "Historical average margin for similar quotes (Phase 2 integration).",
      "type": ["number", "null"],
      "default": null
    }
  },
  "required": [
    "quoteId",
    "projectName",
    "customer",
    "salesRep",
    "projectCodes",
    "controlPanelConfig"
  ]
}