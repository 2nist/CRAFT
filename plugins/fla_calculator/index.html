<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLA & Heater Calculator Plugin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root { --plugin-bg: #111827; --plugin-text: #e5e7eb; --plugin-text-light: #9ca3af; --plugin-border: #374151; --plugin-primary: #3b82f6; --plugin-primary-hover: #2563eb; --plugin-bg-light: #1f2937; }
        body { background-color: var(--plugin-bg); color: var(--plugin-text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
        .input-base { background-color: var(--plugin-bg-light); border: 1px solid var(--plugin-border); color: var(--plugin-text); border-radius: 0.375rem; padding: 0.5rem 0.75rem; width: 100%; }
        .select-base { background-color: var(--plugin-bg-light); border: 1px solid var(--plugin-border); color: var(--plugin-text); border-radius: 0.375rem; padding: 0.5rem 0.75rem; width: 100%; -moz-appearance: none; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%239ca3af' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M6 9l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .label { display: block; font-weight: 500; margin-bottom: 0.5rem; color: var(--plugin-text-light); }
        .tab { padding: 0.5rem 1rem; border-bottom: 2px solid transparent; color: var(--plugin-text-light); cursor: pointer; }
        .tab-active { color: var(--plugin-primary); border-bottom-color: var(--plugin-primary); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- React App ---
        const { useState, useEffect } = React;

        // --- Data Tables ---
        // NEC Table 430.250 Full-Load Current, Three-Phase AC Motors
        const NEC_430_250_3PH = {
            "208V": { 0.5: 2.2, 0.75: 3.1, 1: 4.0, 1.5: 5.9, 2: 7.5, 3: 10.6, 5: 17.5, 7.5: 26, 10: 34, 15: 50, 20: 65, 25: 80, 30: 96, 40: 125, 50: 155, 60: 185, 75: 232, 100: 302, 125: 370, 150: 440, 200: 590 },
            "230V": { 0.5: 2.0, 0.75: 2.8, 1: 3.6, 1.5: 5.2, 2: 6.8, 3: 9.6, 5: 15.2, 7.5: 22, 10: 28, 15: 42, 20: 54, 25: 68, 30: 80, 40: 104, 50: 130, 60: 154, 75: 192, 100: 248, 125: 312, 150: 360, 200: 480 },
            "460V": { 0.5: 1.0, 0.75: 1.4, 1: 1.8, 1.5: 2.6, 2: 3.4, 3: 4.8, 5: 7.6, 7.5: 11, 10: 14, 15: 21, 20: 27, 25: 34, 30: 40, 40: 52, 50: 65, 60: 77, 75: 96, 100: 124, 125: 156, 150: 180, 200: 240 },
            "575V": { 0.5: 0.8, 0.75: 1.1, 1: 1.4, 1.5: 2.1, 2: 2.7, 3: 3.9, 5: 6.1, 7.5: 9.0, 10: 11, 15: 17, 20: 22, 25: 27, 30: 32, 40: 41, 50: 52, 60: 62, 75: 77, 100: 99, 125: 125, 150: 144, 200: 192 }
        };

        // NEC Table 430.248 Full-Load Current, Single-Phase AC Motors
        const NEC_430_248_1PH = {
            "115V": { 0.166: 4.4, 0.25: 5.8, 0.333: 7.2, 0.5: 9.8, 0.75: 13.8, 1: 16, 1.5: 20, 2: 24, 3: 34, 5: 56, 7.5: 80, 10: 100 },
            "230V": { 0.166: 2.2, 0.25: 2.9, 0.333: 3.6, 0.5: 4.9, 0.75: 6.9, 1: 8.0, 1.5: 10, 2: 12, 3: 17, 5: 28, 7.5: 40, 10: 50 }
        };

        // --- Helper Components ---
        function Input({ label, ...props }) {
            return (
                <div>
                    <label className="label">{label}</label>
                    <input className="input-base" {...props} />
                </div>
            );
        }

        function Select({ label, children, ...props }) {
            return (
                <div>
                    <label className="label">{label}</label>
                    <select className="select-base" {...props}>
                        {children}
                    </select>
                </div>
            );
        }

        function ResultDisplay({ fla }) {
            if (fla === null) return null;
            if (isNaN(fla)) {
                return <div className="mt-6 p-4 bg-red-900 border border-red-700 rounded-md text-red-200">Invalid calculation. Check inputs.</div>;
            }
            if (fla === 0) {
                return <div className="mt-6 p-4 bg-yellow-900 border border-yellow-700 rounded-md text-yellow-200">Could not find NEC table value. Using approximate calculation.</div>;
            }

            return (
                <div className="mt-6 p-6 bg-gray-800 rounded-lg">
                    <p className="text-sm text-gray-400">Calculated FLA</p>
                    <p className="text-4xl font-bold text-green-400">{fla.toFixed(2)} A</p>
                </div>
            );
        }

        // --- Motor FLA Calculator ---
        function MotorFLACalculator() {
            const [hp, setHp] = useState('1');
            const [voltage, setVoltage] = useState('460V');
            const [phase, setPhase] = useState('3-Phase');
            const [fla, setFla] = useState(null);

            const calculateFLA = () => {
                const hpNum = parseFloat(hp);
                if (isNaN(hpNum)) {
                    setFla(NaN);
                    return;
                }

                let table;
                if (phase === '3-Phase') {
                    table = NEC_430_250_3PH[voltage];
                } else {
                    table = NEC_430_248_1PH[voltage];
                }

                if (table && table[hpNum]) {
                    setFla(table[hpNum]);
                } else {
                    // Fallback calculation if not in table
                    const efficiency = 0.85;
                    const powerFactor = 0.8;
                    const watts = hpNum * 745.7;
                    let calculatedFla;

                    if (phase === '3-Phase') {
                        const voltNum = parseInt(voltage);
                        calculatedFla = watts / (voltNum * Math.sqrt(3) * efficiency * powerFactor);
                    } else {
                        const voltNum = parseInt(voltage);
                        calculatedFla = watts / (voltNum * efficiency * powerFactor);
                    }
                    setFla(calculatedFla);
                }
            };

            useEffect(calculateFLA, [hp, voltage, phase]);

            return (
                <div className="p-4">
                    <h2 className="text-xl font-semibold mb-4">Motor FLA Calculator</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <Select label="Phase" value={phase} onChange={e => setPhase(e.target.value)}>
                            <option value="3-Phase">3-Phase</option>
                            <option value="1-Phase">1-Phase</option>
                        </Select>
                        <Select label="Voltage" value={voltage} onChange={e => setVoltage(e.target.value)}>
                            {phase === '3-Phase' ? (
                                <>
                                    <option value="208V">208V</option>
                                    <option value="230V">230V</option>
                                    <option value="460V">460V</option>
                                    <option value="575V">575V</option>
                                </>
                            ) : (
                                <>
                                    <option value="115V">115V</option>
                                    <option value="230V">230V</option>
                                </>
                            )}
                        </Select>
                        <Input label="Horsepower (HP)" type="number" value={hp} onChange={e => setHp(e.target.value)} />
                    </div>
                    <ResultDisplay fla={fla} />
                    <p className="text-xs text-gray-500 mt-4">FLA values are based on NEC Tables 430.248 & 430.250. Fallback calculations are estimates.</p>
                </div>
            );
        }

        // --- Heater FLA Calculator ---
        function HeaterFLACalculator() {
            const [kw, setKw] = useState('10');
            const [voltage, setVoltage] = useState('480V');
            const [phase, setPhase] = useState('3-Phase');
            const [fla, setFla] = useState(null);

            const calculateFLA = () => {
                const kwNum = parseFloat(kw);
                const voltNum = parseInt(voltage);

                if (isNaN(kwNum) || isNaN(voltNum) || voltNum === 0) {
                    setFla(NaN);
                    return;
                }

                const watts = kwNum * 1000;
                let calculatedFla;

                if (phase === '3-Phase') {
                    calculatedFla = watts / (voltNum * Math.sqrt(3));
                } else {
                    calculatedFla = watts / voltNum;
                }
                setFla(calculatedFla);
            };

            useEffect(calculateFLA, [kw, voltage, phase]);

            return (
                <div className="p-4">
                    <h2 className="text-xl font-semibold mb-4">Heating Element FLA Calculator</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <Select label="Phase" value={phase} onChange={e => setPhase(e.target.value)}>
                            <option value="3-Phase">3-Phase</option>
                            <option value="1-Phase">1-Phase</option>
                        </Select>
                        <Select label="Voltage" value={voltage} onChange={e => setVoltage(e.target.value)}>
                            <option value="208V">208V</option>
                            <option value="240V">240V</option>
                            <option value="480V">480V</option>
                            <option value="600V">600V</option>
                            <option value="120V">120V (1-Phase Only)</option>
                        </Select>
                        <Input label="Kilowatts (kW)" type="number" value={kw} onChange={e => setKw(e.target.value)} />
                    </div>
                    <ResultDisplay fla={fla} />
                </div>
            );
        }

        // --- Main App Component ---
        function App() {
            const [activeTab, setActiveTab] = useState('motor');

            return (
                <div className="p-4 md:p-8 max-w-3xl mx-auto">
                    <h1 className="text-3xl font-bold text-white mb-6">FLA Calculator</h1>

                    <div className="flex border-b border-gray-700 mb-6">
                        <button
                            onClick={() => setActiveTab('motor')}
                            className={`flex items-center tab ${activeTab === 'motor' ? 'tab-active' : ''}`}
                        >
                            <svg className="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon></svg>
                            Motor FLA
                        </button>
                        <button
                            onClick={() => setActiveTab('heater')}
                            className={`flex items-center tab ${activeTab === 'heater' ? 'tab-active' : ''}`}
                        >
                            <svg className="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>
                            Heater FLA
                        </button>
                    </div>

                    <div className="bg-gray-900 rounded-lg shadow-lg">
                        {activeTab === 'motor' && <MotorFLACalculator />}
                        {activeTab === 'heater' && <HeaterFLACalculator />}
                    </div>
                </div>
            );
        }

        // --- Mount App ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>