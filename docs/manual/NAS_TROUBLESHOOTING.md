# NAS Troubleshooting Guide

This document explains how to run the included `scripts/nas-diagnostics.js` tool and interpret results when the Craft Tools Hub fails to access a NAS runtime root (UNC share).

## Quick steps

- From the project root run:

```
npm run check:nas -- --root "\\\\192.168.1.99\\CraftAuto-Sales\\CACPQDB" --json > nas-report.json
```

- Review `nas-report.json` and attach to support tickets.

## What the script checks

- Resolves runtime root from environment variables `CTH_RUNTIME_ROOT`, `CRAFT_TOOLS_RUNTIME_ROOT`, `CRAFT_TOOLS_NAS_ROOT`, or `--root` argument.
- Pings the host (Windows only) to verify network reachability.
- Verifies directory access and lists a few entries.
- Checks important subfolders: `database`, `OUTPUT`, `Settings`.
- Inspects key DB files for size and modification time.
- Performs a safe read/write test to a `.cth_diag` folder to validate permissions.
- On Windows, lists `cmdkey /list` and `net use` output to help diagnose credential mappings.

## Interpreting common failures

- "No runtime root resolved": set `CTH_RUNTIME_ROOT` or pass `--root`.
- "Ping failed": network connectivity or host name resolution issue.
- "Access denied" on directory access or read/write tests: likely missing SMB credentials or insufficient permissions.
- Missing `database` folder or DB files: the NAS share is not the expected runtime root.

## Next steps for support

- If the script shows ping but fails on read/write, check Windows Credentials Manager and `net use` entries.
- If `cmdkey` contains stored credentials, try removing the incorrect entries and reconnecting.
- If the NAS is intermittently accessible, verify switch/router logs and SMB server health.

## Advanced

- Use `--skip-ping` and `--skip-write` to avoid operations when running from restricted CI.
- Use `--json` to produce machine-readable output for automated ingestion.

---
Generated by the diagnostics tooling in the repo.

## Renderer diagnostics & IPC

During beta we expose two IPC endpoints so the renderer can surface runtime status and run the diagnostics script from the Settings UI:

- `runtime:get-status` — returns the same status object consumed by the app (runtime root, message, buildInfo, error).
- `runtime:run-diagnostics` — runs `scripts/nas-diagnostics.js` in non-destructive mode and returns JSON output (uses `--skip-write` by default).

The UI stub `src/components/RuntimeStatus.jsx` demonstrates how the renderer can call these endpoints and display results. The IPC endpoints are intentionally non-destructive and intended for support usage.
